- for session in sessions
  .session
    .agent= session.user_agent
    - split_by_common(session.pages) { |page| [format_time(page.created_at, false), page.address] }.each do |(date, address), pages|
      %div
        .date_addr
          = date
          \:
          = address
          - if gi = GEOIP.look_up(address)
            \:
            - if gi[:city]
              = gi[:city].force_encoding("UTF-8")
            - if gi[:region]
              = gi[:region].force_encoding("UTF-8")
            - if gi[:country_name]
              [#{gi[:country_name].force_encoding("UTF-8")}]
            - if gi[:postal_code]
              \,
              = gi[:postal_code]
            - if gi[:area_code]
              = "(#{gi[:area_code]})"
          - else
            Unknown
      - for page in pages
        %div
          = page.created_at.strftime(" %I:%M:%S %p")
          \:
          %a{ :href => url_for(page.uri) }&= page.uri.inspect
          \:
          - if page.referer
            %span.referer
              != referer_tag(page.referer)
